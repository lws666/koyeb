name: 定时访问网站

# 配置定时触发规则：每5分钟执行一次
on:
  schedule:
    # cron表达式格式：分 时 日 月 周
    # */5 表示每5分钟
    - cron: '*/5 * * * *'
  # 手动触发（可选）
  workflow_dispatch:

# 工作流执行配置
jobs:
  visit-website:
    # 运行环境
    runs-on: ubuntu-latest
    steps:
      # 步骤1：设置Python环境
      - name: 设置Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      # 步骤2：安装依赖
      - name: 安装requests库
        run: pip install requests
      
      # 步骤3：执行访问脚本
      - name: 访问目标网站
        run: |
          python - <<EOF
          import requests
          import logging

          # 配置日志
          logging.basicConfig(level=logging.INFO)

          # 替换为你的目标网站
          url = "https://unpleasant-cecelia-lwsnb6666-7b504a4b.koyeb.app/sub"
          headers = {
              'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
          }

          try:
              response = requests.get(url, headers=headers, timeout=10)
              if response.status_code == 200:
                  logging.info(f"成功访问 {url}，状态码：{response.status_code}")
              else:
                  logging.warning(f"访问 {url} 失败，状态码：{response.status_code}")
          except Exception as e:
              logging.error(f"访问出错：{str(e)}")
              exit(1)
          EOF
